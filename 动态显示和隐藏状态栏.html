<!DOCTYPE html><html><head><title>动态显示和隐藏状态栏</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-10" class="wmd-preview-section preview-content">

</div><div id="wmd-preview-section-34" class="wmd-preview-section preview-content">

<h3 id="动态显示和隐藏状态栏">动态显示和隐藏状态栏</h3>

<p>小米Launcher有一个细节上的功能效果：在长按桌面应用图标时，会隐藏状态栏，然后在状态栏原有的布局上显示卸载或删除的操作栏。放手后，操作栏隐藏，状态栏显示出来。也就是说，这个过程是涉及到对状态栏的动态操作的。</p>

<pre class="prettyprint hljs-dark"><code class="hljs bash"><div><div><div><div><div><div><div><div><div><div><div>View类提供了<span class="hljs-built_in">set</span>SystemUiVisibility和getSystemUiVisibility方法，这两个方法实现对状态栏的动态显示或隐藏的操作，以及获取状态栏当前可见性。</div><br></div></div></div></div></div></div></div></div></div></div></code></pre>

<p>setSystemUiVisibility(int visibility)方法可传入的实参为：</p>

<pre class="prettyprint hljs-dark"><code class="hljs stata"><div><div><div><div><div><div><div><div><div><div><div>1. <span class="hljs-keyword">View</span>.SYSTEM_UI_FLAG_VISIBLE：显示状态栏，Activity不全屏显示(恢复到有状态的正常情况)。</div><br><div>2. <span class="hljs-keyword">View</span>.INVISIBLE：隐藏状态栏，同时Activity会伸展全屏显示。</div><br><div>3. <span class="hljs-keyword">View</span>.SYSTEM_UI_FLAG_FULLSCREEN：Activity全屏显示，且状态栏被隐藏覆盖掉。</div><br><div>4. <span class="hljs-keyword">View</span>.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN：Activity全屏显示，但状态栏不会被隐藏覆盖，状态栏依然可见，Activity顶端布局部分会被状态遮住。</div><br><div>5. <span class="hljs-keyword">View</span>.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION：效果同<span class="hljs-keyword">View</span>.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN</div><br><div>6. <span class="hljs-keyword">View</span>.SYSTEM_UI_LAYOUT_FLAGS：效果同<span class="hljs-keyword">View</span>.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN</div><br><div>7. <span class="hljs-keyword">View</span>.SYSTEM_UI_FLAG_HIDE_NAVIGATION：隐藏虚拟按键(导航栏)。有些手机会用虚拟按键来代替物理按键。</div><br><div>8. <span class="hljs-keyword">View</span>.SYSTEM_UI_FLAG_LOW_PROFILE：状态栏显示处于低能显示状态(low profile模式)，状态栏上一些图标显示会被隐藏。</div><br></div></div></div></div></div></div></div></div></div></div></code></pre>

<p>下面将以一个demo来验证view的setSystemUiVisibility(int visibility)方法实现动态操作状态栏:</p>

<p><strong>1.MainActivity代码如下：</strong></p></div><div id="wmd-preview-section-44" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs groovy"><div><div><div><div><div><div><div><div><span class="hljs-keyword">package</span> com.example.handlestatusbar;  </div><br><div><span class="hljs-keyword">import</span> android.annotation.SuppressLint;  </div><div><span class="hljs-keyword">import</span> android.app.Activity;  </div><div><span class="hljs-keyword">import</span> android.os.Bundle;  </div><div><span class="hljs-keyword">import</span> android.view.Menu;  </div><div><span class="hljs-keyword">import</span> android.view.MenuItem;  </div><div><span class="hljs-keyword">import</span> android.view.View;  </div><div><span class="hljs-keyword">import</span> android.view.View.OnClickListener;  </div><div><span class="hljs-keyword">import</span> android.widget.Button;  </div><div><span class="hljs-keyword">import</span> android.widget.RelativeLayout;  </div><div><span class="hljs-keyword">import</span> android.widget.Toast;  </div><br><div><span class="hljs-annotation">@SuppressLint</span>(<span class="hljs-string">"NewApi"</span>)  </div><div><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OnClickListener</span>  </span></div><div>{  </div><br><div>    <span class="hljs-keyword">private</span> RelativeLayout mRLayout;  </div><div>    <span class="hljs-keyword">private</span> Button mBtn1, mBtn2, mBtn3, mBtn4, mBtn5, mBtn6, mBtn7, mBtn8;  </div><br><div>    <span class="hljs-annotation">@Override</span>  </div><div>    <span class="hljs-keyword">protected</span> <span class="hljs-typename">void</span> onCreate(Bundle savedInstanceState)   </div><div>    {  </div><div>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);  </div><div>        setContentView(R.layout.main);  </div><br><div>        mRLayout = (RelativeLayout)findViewById(R.id.content);  </div><div>        mBtn1 = (Button)findViewById(R.id.btn1);  </div><div>        mBtn2 = (Button)findViewById(R.id.btn2);  </div><div>        mBtn3 = (Button)findViewById(R.id.btn3);  </div><div>        mBtn4 = (Button)findViewById(R.id.btn4);  </div><div>        mBtn5 = (Button)findViewById(R.id.btn5);  </div><div>        mBtn6 = (Button)findViewById(R.id.btn6);  </div><div>        mBtn7 = (Button)findViewById(R.id.btn7);  </div><div>        mBtn8 = (Button)findViewById(R.id.btn8);  </div><br><div>        mBtn1.setOnClickListener(<span class="hljs-keyword">this</span>);  </div><div>        mBtn2.setOnClickListener(<span class="hljs-keyword">this</span>);  </div><div>        mBtn3.setOnClickListener(<span class="hljs-keyword">this</span>);  </div><div>        mBtn4.setOnClickListener(<span class="hljs-keyword">this</span>);  </div><div>        mBtn5.setOnClickListener(<span class="hljs-keyword">this</span>);  </div><div>        mBtn6.setOnClickListener(<span class="hljs-keyword">this</span>);  </div><div>        mBtn7.setOnClickListener(<span class="hljs-keyword">this</span>);  </div><div>        mBtn8.setOnClickListener(<span class="hljs-keyword">this</span>);       </div><div>    }  </div><br><div>    <span class="hljs-annotation">@Override</span>  </div><div>    <span class="hljs-keyword">public</span> <span class="hljs-typename">void</span> onClick(View v)  </div><div>    {  </div><div>        <span class="hljs-comment">// TODO Auto-generated method stub  </span></div><div>        <span class="hljs-keyword">switch</span> (v.getId())   </div><div>        {  </div><div>        <span class="hljs-keyword">case</span> R.id.<span class="hljs-string">btn1:</span>  </div><div>            <span class="hljs-comment">//显示状态栏，Activity不全屏显示(恢复到有状态的正常情况)  </span></div><div>            mRLayout.setSystemUiVisibility(View.SYSTEM_UI_FLAG_VISIBLE);      </div><div>            <span class="hljs-keyword">break</span>;  </div><div>        <span class="hljs-keyword">case</span> R.id.<span class="hljs-string">btn2:</span>  </div><div>            <span class="hljs-comment">//隐藏状态栏，同时Activity会伸展全屏显示  </span></div><div>            mRLayout.setSystemUiVisibility(View.INVISIBLE);  </div><div>            <span class="hljs-keyword">break</span>;  </div><div>        <span class="hljs-keyword">case</span> R.id.<span class="hljs-string">btn3:</span>  </div><div>            <span class="hljs-comment">//Activity全屏显示，且状态栏被隐藏覆盖掉。  </span></div><div>            mRLayout.setSystemUiVisibility(View.SYSTEM_UI_FLAG_FULLSCREEN);  </div><div>            <span class="hljs-keyword">break</span>;        </div><div>        <span class="hljs-keyword">case</span> R.id.<span class="hljs-string">btn4:</span>  </div><div>            <span class="hljs-comment">//Activity全屏显示，但状态栏不会被隐藏覆盖，状态栏依然可见，Activity顶端布局部分会被状态遮住  </span></div><div>            mRLayout.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN);  </div><div>            <span class="hljs-keyword">break</span>;  </div><br><div>        <span class="hljs-keyword">case</span> R.id.<span class="hljs-string">btn5:</span>  </div><div>            <span class="hljs-comment">//同mRLayout.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN);  </span></div><div>            mRLayout.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION);  </div><div>            <span class="hljs-keyword">break</span>;  </div><div>        <span class="hljs-keyword">case</span> R.id.<span class="hljs-string">btn6:</span>  </div><div>            <span class="hljs-comment">//同mRLayout.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN);  </span></div><div>            mRLayout.setSystemUiVisibility(View.SYSTEM_UI_LAYOUT_FLAGS);  </div><div>            <span class="hljs-keyword">break</span>;  </div><div>        <span class="hljs-keyword">case</span> R.id.<span class="hljs-string">btn7:</span>  </div><div>            <span class="hljs-comment">//隐藏虚拟按键(导航栏)  </span></div><div>            mRLayout.setSystemUiVisibility(View.SYSTEM_UI_FLAG_HIDE_NAVIGATION);  </div><div>            <span class="hljs-keyword">break</span>;  </div><div>        <span class="hljs-keyword">case</span> R.id.<span class="hljs-string">btn8:</span>  </div><div>            <span class="hljs-comment">//状态栏显示处于低能显示状态(low profile模式)，状态栏上一些图标显示会被隐藏。  </span></div><div>            mRLayout.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LOW_PROFILE);  </div><div>            <span class="hljs-keyword">break</span>;  </div><div>        }  </div><div>    }  </div><br><div>}  </div></div></div></div></div></div></div></div></code></pre>

<p><strong>2.布局文件main.xml文件的代码如下：</strong></p>

</div><div id="wmd-preview-section-65" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs nix"><div><div><div>[html] view plaincopy</div><div>&lt;RelativeLayout xmlns:<span class="hljs-variable">android=</span><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>  </div><div>    xmlns:<span class="hljs-variable">tools=</span><span class="hljs-string">"http://schemas.android.com/tools"</span>  </div><div>    android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"match_parent"</span>  </div><div>    android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"match_parent"</span>  </div><div>    tools:<span class="hljs-variable">context=</span><span class="hljs-string">".MainActivity"</span>   </div><div>    android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/content"</span>&gt;  </div><br><div>   &lt;LinearLayout   </div><div>       android:<span class="hljs-variable">orientation=</span><span class="hljs-string">"vertical"</span>  </div><div>       android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"match_parent"</span>  </div><div>       android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"match_parent"</span>&gt;  </div><div>        &lt;Button   </div><div>        android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/btn1"</span>  </div><div>        android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"fill_parent"</span>  </div><div>        android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"wrap_content"</span>  </div><div>        android:<span class="hljs-variable">text=</span><span class="hljs-string">"@string/s1"</span>/&gt;  </div><br><div>    &lt;Button   </div><div>        android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/btn2"</span>  </div><div>        android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"fill_parent"</span>  </div><div>        android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"wrap_content"</span>  </div><div>        android:<span class="hljs-variable">text=</span><span class="hljs-string">"@string/s2"</span>/&gt;  </div><br><div>    &lt;Button   </div><div>        android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/btn3"</span>  </div><div>        android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"fill_parent"</span>  </div><div>        android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"wrap_content"</span>  </div><div>        android:<span class="hljs-variable">text=</span><span class="hljs-string">"@string/s3"</span>/&gt;  </div><br><div>    &lt;Button   </div><div>        android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/btn4"</span>  </div><div>        android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"fill_parent"</span>  </div><div>        android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"wrap_content"</span>  </div><div>        android:<span class="hljs-variable">text=</span><span class="hljs-string">"@string/s4"</span>/&gt;  </div><br><div>    &lt;Button   </div><div>        android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/btn5"</span>  </div><div>        android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"fill_parent"</span>  </div><div>        android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"wrap_content"</span>  </div><div>        android:<span class="hljs-variable">text=</span><span class="hljs-string">"@string/s5"</span>/&gt;  </div><br><div>    &lt;Button   </div><div>        android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/btn6"</span>  </div><div>        android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"fill_parent"</span>  </div><div>        android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"wrap_content"</span>  </div><div>        android:<span class="hljs-variable">text=</span><span class="hljs-string">"@string/s6"</span>/&gt;  </div><br><div>    &lt;Button   </div><div>        android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/btn7"</span>  </div><div>        android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"fill_parent"</span>  </div><div>        android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"wrap_content"</span>  </div><div>        android:<span class="hljs-variable">text=</span><span class="hljs-string">"@string/s7"</span>/&gt;  </div><br><div>    &lt;Button   </div><div>        android:<span class="hljs-variable">id=</span><span class="hljs-string">"@+id/btn8"</span>  </div><div>        android:<span class="hljs-variable">layout_width=</span><span class="hljs-string">"fill_parent"</span>  </div><div>        android:<span class="hljs-variable">layout_height=</span><span class="hljs-string">"wrap_content"</span>  </div><div>        android:<span class="hljs-variable">text=</span><span class="hljs-string">"@string/s8"</span>/&gt;  </div><br><div>   &lt;/LinearLayout&gt;  </div><br><br><div>&lt;/RelativeLayout&gt;  </div></div></div></code></pre>

<p><strong>3.string.xml文件代码如下：</strong>    </p>

</div><div id="wmd-preview-section-66" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs applescript"><div><div><div>[html] view plaincopy</div><div>&lt;?xml <span class="hljs-property">version</span>=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;  </div><div>&lt;resources&gt;  </div><br><br><br><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"app_name"</span>&gt;HandleStatusBar&lt;/<span class="hljs-type">string</span>&gt;  </div><br><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"hello_world"</span>&gt;Hello world!&lt;/<span class="hljs-type">string</span>&gt;  </div><br><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"menu_settings"</span>&gt;Settings&lt;/<span class="hljs-type">string</span>&gt;  </div><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"s1"</span>&gt;SYSTEM_UI_FLAG_VISIBLE&lt;/<span class="hljs-type">string</span>&gt;  </div><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"s2"</span>&gt;INVISIBLE&lt;/<span class="hljs-type">string</span>&gt;  </div><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"s3"</span>&gt;SYSTEM_UI_FLAG_FULLSCREEN&lt;/<span class="hljs-type">string</span>&gt;  </div><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"s4"</span>&gt;SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN&lt;/<span class="hljs-type">string</span>&gt;  </div><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"s5"</span>&gt;SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION&lt;/<span class="hljs-type">string</span>&gt;  </div><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"s6"</span>&gt;SYSTEM_UI_LAYOUT_FLAGS&lt;/<span class="hljs-type">string</span>&gt;  </div><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"s7"</span>&gt;SYSTEM_UI_FLAG_HIDE_NAVIGATION&lt;/<span class="hljs-type">string</span>&gt;  </div><div>    &lt;<span class="hljs-type">string</span> <span class="hljs-property">name</span>=<span class="hljs-string">"s8"</span>&gt;SYSTEM_UI_FLAG_LOW_PROFILE&lt;/<span class="hljs-type">string</span>&gt;  </div><br><br><div>&lt;/resources&gt;  </div></div></div></code></pre></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>